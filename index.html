<!DOCTYPE html>
<html dir="rtl" lang="he">
  <head>
    <meta charset="UTF-8" />
    <title>×—×™×“×•×Ÿ ×˜×§×¡×•× ×•××™×”</title>
    <!-- Include Confetti.js via CDN -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Rubik:wght@400;500;600;700&display=swap");

      body {
        font-family: "Rubik", "Inter", system-ui, sans-serif;
        margin: 0;
        padding: 2rem;
        min-height: 100vh;
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        color: #f8fafc;
        line-height: 1.5;
        direction: rtl;
      }

      .slide {
        max-width: 1000px;
        margin: 0 auto;
        padding: 2.5rem;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 24px;
        backdrop-filter: blur(12px);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
        animation: slideIn 0.6s ease-out;
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .header {
        text-align: center;
        margin-bottom: 1rem;
      }

      .title {
        font-size: 3rem;
        font-weight: 700;
        margin: 0;
        background: linear-gradient(135deg, #60a5fa, #a78bfa);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: gradientFlow 8s linear infinite;
        background-size: 200% 200%;
      }

      @keyframes gradientFlow {
        0% {
          background-position: 0% 50%;
        }
        50% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0% 50%;
        }
      }

      .subtitle {
        font-size: 1.25rem;
        color: #94a3b8;
      }

      .scores {
        display: flex;
        justify-content: center;
        gap: 2rem;
        margin-top: 2em;
      }

      .team {
        padding: 1rem 2rem;
        border-radius: 16px;
        font-weight: 600;
        min-width: 150px;
        text-align: center;
        transition: transform 0.3s ease;
      }

      .team:hover {
        transform: translateY(-2px);
      }

      .team-a {
        background: linear-gradient(
          135deg,
          rgb(255, 105, 180, 0.2),
          rgba(255, 105, 180, 0.1)
        );
        border: 1px solid rgba(255, 105, 180, 0.4);
      }

      .team-b {
        background: linear-gradient(
          135deg,
          rgba(59, 130, 246, 0.2),
          rgba(59, 130, 246, 0.1)
        );
        border: 1px solid rgba(59, 130, 246, 0.2);
      }

      .team.score-updated {
        animation: drawGoldenBorder 0.5s ease-in-out alternate;
        animation-iteration-count: 3;
        animation-fill-mode: forwards;
      }

      @keyframes drawGoldenBorder {
        0% {
          border: 0px solid rgba(247, 190, 3, 0);
          box-shadow: 0 0 5px rgba(247, 190, 3, 0.2);
        }

        50% {
          border: 1px solid rgba(247, 190, 3, 0.7);
          box-shadow: 0 0 15px rgba(247, 190, 3, 0.7);
        }

        100% {
          border: 2px solid rgba(247, 190, 3, 1);
          box-shadow: 0 0 25px rgba(247, 190, 3, 1);
        }
      }

      .main-content {
        margin: 1rem 0;
      }

      .target-animal {
        text-align: center;
        padding: 0.5rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 20px;
      }

      .target-animal img {
        width: 400px;
        height: 260px;
        object-fit: cover;
        border-radius: 16px;
        margin-bottom: 1.5rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        animation: imageFadeIn 0.8s ease-out;
      }

      @keyframes imageFadeIn {
        from {
          opacity: 0;
          transform: scale(0.95);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      .target-animal img:hover {
        transform: scale(1.02);
        box-shadow: 0 8px 12px -1px rgba(0, 0, 0, 0.2);
      }

      .target-animal h2 {
        font-size: 2rem;
        margin: 0;
        color: #f8fafc;
      }

      .options {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 2rem;
        margin-top: 1rem;
      }

      .option {
        position: relative;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 16px;
        padding: 1rem;
        cursor: pointer;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        animation: optionFadeIn 0.6s ease-out backwards;
      }

      .option:nth-child(1) {
        animation-delay: 0.2s;
      }
      .option:nth-child(2) {
        animation-delay: 0.4s;
      }
      .option:nth-child(3) {
        animation-delay: 0.6s;
      }

      @keyframes optionFadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .option:hover {
        transform: translateY(-4px) scale(1.02);
        background: rgba(255, 255, 255, 0.08);
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
      }

      .option img {
        width: 100%;
        height: 200px;
        object-fit: cover;
        border-radius: 12px;
        margin-bottom: 1rem;
      }

      .option h3 {
        margin: 0;
        font-size: 1.25rem;
        text-align: center;
      }

      .team-label {
        position: absolute;
        top: -12px;
        right: 50%;
        transform: translateX(50%);
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.875rem;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .selected-a {
        border: 2px solid #ff69b4;
      }

      .selected-a .team-label {
        background: #ff69b4;
        opacity: 1;
      }

      .selected-b {
        border: 2px solid #3b82f6;
      }

      .selected-b .team-label {
        background: #3b82f6;
        opacity: 1;
      }

      .shared .team-label {
        background: #fbbf24;
        color: #000;
      }

      .option.correct {
        border: 2px solid #ff69b4;
        animation: correctAnswer 1s ease-out forwards;
        animation-iteration-count: 2;
      }

      @keyframes correctAnswer {
        0% {
          transform: scale(1);
          border-color: rgba(34, 197, 94, 0.4);
          background: rgba(34, 197, 94, 0.2);
        }
        50% {
          transform: scale(1.05);
          border-color: rgba(34, 197, 94, 0.8);
        }
        100% {
          transform: scale(1);
          border-color: rgba(34, 197, 94, 1);
          box-shadow: 0 0 20px rgba(34, 197, 94, 0.4);
          background: rgba(34, 197, 94, 0.5);
        }
      }

      .option.incorrect {
        border: 2px solid #ef4444;
        background: rgba(239, 68, 68, 0.2);
        opacity: 0.5;
        animation: incorrectAnswer 0.5s ease-out forwards;
      }

      @keyframes incorrectAnswer {
        0%,
        100% {
          transform: translateX(0);
        }
        20%,
        60% {
          transform: translateX(-5px);
        }
        40%,
        80% {
          transform: translateX(5px);
        }
      }
      .option.shared {
        border: 3px dashed #fbbf24;
        background: rgba(251, 191, 36, 0.2);
      }

      .controls {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-top: 3rem;
      }

      button {
        padding: 0.875rem 2rem;
        border: none;
        border-radius: 12px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        background: rgba(255, 255, 255, 0.1);
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.1);
        position: relative;
        overflow: hidden;
      }

      button:not(:disabled):hover {
        transform: translateY(-2px);
        background: rgba(255, 255, 255, 0.15);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      button:not(:disabled):active {
        transform: translateY(1px);
      }

      button:not(:disabled)::after {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 5px;
        height: 5px;
        background: rgba(255, 255, 255, 0.5);
        opacity: 0;
        border-radius: 100%;
        transform: scale(1, 1) translate(-50%);
        transform-origin: 50% 50%;
      }

      button:not(:disabled):focus:not(:active)::after {
        animation: ripple 1s ease-out;
      }

      @keyframes ripple {
        0% {
          transform: scale(0, 0);
          opacity: 0.5;
        }
        100% {
          transform: scale(50, 50);
          opacity: 0;
        }
      }

      button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .footer {
        text-align: center;
        margin-top: 2rem;
        color: #94a3b8;
        font-size: 0.875rem;
      }

      .explanation {
        margin-top: 2rem;
        padding: 1rem;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 16px;
        display: none;
      }

      .explanation h3 {
        margin: 0 0 0.5rem 0;
        font-size: 1.25rem;
        text-align: center;
        color: #f8fafc;
      }

      #taxonomy-diagram {
        padding: 2rem;
        border-radius: 8px;
        margin-top: 1rem;
        overflow-x: auto;
      }

      .mermaid {
        display: flex;
        justify-content: center;
      }

      /* Final Screen Styles */
      .final-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(15, 23, 42, 0.95);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: #f8fafc;
        z-index: 1000;
        display: none; /* Hidden by default */
        animation: finalScreenFade 0.8s ease-out;
      }
      @keyframes finalScreenFade {
        from {
          opacity: 0;
          transform: scale(0.9);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      .final-screen h2 {
        font-size: 2.5rem;
        margin-bottom: 1rem;
        background: linear-gradient(135deg, #f472b6, #60a5fa);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .final-screen p {
        font-size: 1.5rem;
        margin: 0.5rem 0;
      }

      .final-screen button {
        margin-top: 2rem;
        padding: 0.875rem 2rem;
        border: none;
        border-radius: 12px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        background: #3b82f6;
        color: white;
      }

      .final-screen button:hover {
        background: #2563eb;
      }

      @keyframes correctPulse {
        0%,
        100% {
          background: rgba(34, 197, 94, 0.4);
          box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4);
        }
        50% {
          background: rgba(34, 197, 94, 0.1);
          box-shadow: 0 0 0 10px rgba(34, 197, 94, 0);
        }
      }

      /* Modal Styles */
      .modal {
        display: none; /* Hidden by default */
        position: fixed;
        z-index: 2000; /* Above other content */
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.9); /* Black with opacity */
        align-items: center;
        justify-content: center;
        padding: 2rem;
        transition: opacity 0.3s ease;
      }

      .modal-content {
        position: relative;
        background-color: #1e293b;
        margin: auto;
        padding: 1rem;
        border: 1px solid #888;
        width: 90%;
        max-width: 1200px;
        border-radius: 16px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        animation: modalSlideIn 0.4s ease-out;
      }

      @keyframes modalSlideIn {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .close-modal {
        position: absolute;
        top: 10px;
        right: 25px;
        color: #f8fafc;
        font-size: 35px;
        font-weight: bold;
        cursor: pointer;
      }

      .close-modal:hover,
      .close-modal:focus {
        color: #bbb;
        text-decoration: none;
        cursor: pointer;
      }

      .open-modal-btn {
        margin-top: 1rem;
        padding: 0.5rem 1rem;
        background: #4f46e5;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: background 0.3s ease;
      }

      .open-modal-btn:hover {
        background: #4338ca;
      }
    </style>
  </head>
  <body>
    <div class="slide">
      <div class="header">
        <h1 class="title">×—×™×“×•×Ÿ ×˜×§×¡×•× ×•××™×” - ××‘×•× ×œ×‘×™×•×œ×•×’×™×” ×œ×ª×œ××™×“×™ ××“×¢×™×</h1>
        <div class="subtitle">××™×–×• ×—×™×” ×§×¨×•×‘×” ×‘×™×•×ª×¨ ××‘×—×™× ×” ××‘×•×œ×•×¦×™×•× ×™×ª?</div>
      </div>

      <div class="main-content">
        <div class="target-animal">
          <img id="main-animal-img" alt="×—×™×” ×¨××©×™×ª" />
          <h2 id="main-animal-name"></h2>
        </div>

        <div class="options" id="options-container"></div>
        <div class="scores">
          <div class="team team-a">×§×‘×•×¦×” ××³: <span id="score-a">0</span></div>
          <div class="team team-b">×§×‘×•×¦×” ×‘×³: <span id="score-b">0</span></div>
        </div>
        <!-- Explanation Section -->
        <div class="explanation" id="explanation-container">
          <h3>×”×©×•×•××ª ×¡×™×•×•×’ ×˜×§×¡×•× ×•××™</h3>
          <div id="taxonomy-diagram"></div>
          <button class="open-modal-btn" id="view-fullscreen-btn">
            ××¡×š ××œ×
          </button>
        </div>
      </div>

      <div class="controls">
        <button id="reveal-btn" disabled>×’×œ×” ×ª×©×•×‘×”</button>
        <button id="next-btn" disabled>×©××œ×” ×”×‘××”</button>
        <button id="finish-btn">×¡×™×™× ××ª ×”×—×™×“×•×Ÿ</button>
      </div>

      <div class="footer">
        ×©××œ×” <span id="current-question">1</span>/<span id="total-questions"
          >0</span
        >
      </div>
    </div>

    <!-- Final Screen -->
    <div class="final-screen" id="final-screen">
      <h2 id="final-message">×× ×¦×—×ª!</h2>
      <p id="final-scores">×§×‘×•×¦×” ××³: 0 × ×§×•×“×•×ª | ×§×‘×•×¦×” ×‘×³: 0 × ×§×•×“×•×ª</p>
      <button id="restart-btn" style="display: none">×”×ª×—×œ ××—×“×©</button>
    </div>

    <!-- Full-Screen Modal for Taxonomy Diagram -->
    <div id="diagram-modal" class="modal">
      <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h3 style="text-align: center; color: #f8fafc">×˜×§×¡×•× ×•××™×” ××œ××”</h3>
        <div id="fullscreen-taxonomy-diagram" style="margin-top: 1rem"></div>
      </div>
    </div>

    <script>
      const quizData = [
        // 1) ×œ×•×•×™×™×ª×Ÿ ×›×—×•×œ
        {
          mainAnimal: {
            name: "×œ×•×™×™×ª×Ÿ ×›×—×•×œ",
            image: "images/whale.jpg",
            taxonomy: {
              Kingdom: "×‘×¢×œ×™ ×—×™×™×",
              Phylum: "××™×ª×¨× ×™×™×",
              Class: "×™×•× ×§×™×",
              Order: "××›×¤×™×œ×™ ×¤×¨×¡×”", // ×›×™×•× ×œ×•×•×™×™×ª× ×™× ××©×•×™×›×™× ×œ×¡×“×¨×” ×–×• (Cetacea ×›×¢× ×£ ×‘×ª×•×š Artiodactyla)
              Family: "×œ×•×•×™×™×ª× ×™ ×¢× ×§",
              Genus: "×œ×•×™×ª×Ÿ",
              Species: "×œ×•×™×ª×Ÿ ×›×—×•×œ",
            },
          },
          options: [
            {
              name: "×›×œ×‘ ×™× ××–×•×§×Ÿ",
              image: "images/seal.jpg",
              taxonomy: {
                Kingdom: "×‘×¢×œ×™ ×—×™×™×",
                Phylum: "××™×ª×¨× ×™×™×",
                Class: "×™×•× ×§×™×",
                Order: "×˜×•×¨×¤×™×",
                Family: "×›×œ×‘×™ ×™×", // (Phocidae)
                Genus: "×›×œ×‘ ×™×",
                Species: "×›×œ×‘ ×™× ××–×•×§×Ÿ",
              },
            },
            {
              name: "×‘×™×–×•×Ÿ",
              image: "images/bison.jpg",
              correct: true,
              taxonomy: {
                Kingdom: "×‘×¢×œ×™ ×—×™×™×",
                Phylum: "××™×ª×¨× ×™×™×",
                Class: "×™×•× ×§×™×",
                Order: "××›×¤×™×œ×™ ×¤×¨×¡×”",
                Family: "×¤×¨×™×™×",
                Genus: "×‘×™×–×•×Ÿ",
                Species: "×‘×™×–×•×Ÿ ×××¨×™×§××™",
              },
            },
            {
              name: "×ª×—×© × ×”×¨×•×ª",
              image: "images/manatee.jpg",
              taxonomy: {
                Kingdom: "×‘×¢×œ×™ ×—×™×™×",
                Phylum: "××™×ª×¨× ×™×™×",
                Class: "×™×•× ×§×™×",
                Order: "×ª×—×©××™×", // Sirenia
                Family: "×ª×—×©×™ ×”× ×”×¨×•×ª",
                Genus: "×ª×—×© ×”× ×”×¨×•×ª",
                Species: "×ª×—×© ×”× ×”×¨×•×ª ×”×§×¨×™×‘×™", // ×›×“×•×’××ª Trichechus manatus
              },
            },
          ],
          explanation:
            "×”×œ×•×•×™×™×ª×Ÿ ×§×¨×•×‘ ×™×•×ª×¨ ××‘×—×™× ×” ××‘×•×œ×•×¦×™×•× ×™×ª ×œ×‘×™×–×•×Ÿ ×××©×¨ ×œ×›×œ×‘ ×™× ××• ×ª×—×© × ×”×¨×•×ª.",
        },

        // 2) ×›×œ×‘ ×”×‘×™×ª
        {
          mainAnimal: {
            name: "×›×œ×‘ ×”×‘×™×ª",
            image: "images/dog.jpg",
            taxonomy: {
              Kingdom: "×‘×¢×œ×™ ×—×™×™×",
              Phylum: "××™×ª×¨× ×™×™×",
              Class: "×™×•× ×§×™×",
              Order: "×˜×•×¨×¤×™×", // (Hyracoidea)
              Family: "×›×œ×‘×™×™×", // (Procaviidae)
              Genus: "×›×œ×‘", // ×ª×¨×’×•× ×—×•×¤×©×™ ×‘××§×•× Procavia
              Species: "×–××‘ ××¦×•×™",
            },
          },
          options: [
            {
              name: "×¤× ×§ (Fennec Fox)",
              image: "images/fennec.jpg",
              correct: true,
              taxonomy: {
                Kingdom: "×‘×¢×œ×™ ×—×™×™×",
                Phylum: "××™×ª×¨× ×™×™×",
                Class: "×™×•× ×§×™×",
                Order: "×˜×•×¨×¤×™×", // (Proboscidea)
                Family: "×›×œ×‘×™×™×", // (Elephantidae)
                Genus: "×©×•×¢×œ", // ×ª×¨×’×•×/×ª×¢×ª×™×§ ×©×œ Loxodonta
                Species: "×¤× ×§",
              },
            },
            {
              name: "×¦×‘×•×¢",
              image: "images/hyena.jpg",
              taxonomy: {
                Kingdom: "×‘×¢×œ×™ ×—×™×™×",
                Phylum: "××™×ª×¨× ×™×™×",
                Class: "×™×•× ×§×™×",
                Order: "×˜×•×¨×¤×™×",
                Family: "×¦×‘×•×¢×™×™×", // (Hyaenidae)
                Genus: "×¦×‘×•×¢ × ×§×•×“", // (Crocuta/Hyaena) â€“ ×›××Ÿ ×¤×©×•×˜ "×¦×‘×•×¢"
                Species: "×¦×‘×•×¢ × ×§×•×“", // (Crocuta crocuta)
              },
            },
            {
              name: "×–××‘ ×˜×¡×× ×™ (× ×›×—×“)",
              image: "images/thylacinus.jpg",
              taxonomy: {
                Kingdom: "×‘×¢×œ×™ ×—×™×™×",
                Phylum: "××™×ª×¨× ×™×™×",
                Class: "×™×•× ×§×™×",
                Order: "×˜×•×¨×¤×™ ×›×™×¡", // (Lagomorpha)
                Family: "×–××‘×™ ×›×™×¡", // (Leporidae)
                Genus: "×–××‘ ×›×™×¡",
                Species: "×–××‘ ×˜×¡×× ×™",
              },
            },
          ],
          explanation:
            "×©×¤×Ÿ ×¡×œ×¢ ×§×¨×•×‘ ×™×•×ª×¨ ××‘×—×™× ×” ××‘×•×œ×•×¦×™×•× ×™×ª ×œ×¤×™×œ ×××©×¨ ×œ×§×¤×™×‘×¨×” ××• ××¨× ×‘×ª ×‘×¨.",
        },

        // 3) ×“×™× ×•×–××•×¨
        {
          mainAnimal: {
            name: "×—×ª×•×œ ×”×‘×™×ª",
            image: "images/cat.jpg",
            taxonomy: {
              Kingdom: "×‘×¢×œ×™ ×—×™×™×",
              Phylum: "××™×ª×¨× ×™×™×",
              Class: "×™×•× ×§×™×",
              Order: "×˜×•×¨×¤×™×", // (Carnivora)
              Family: "×—×ª×•×œ×™×™×", // (Felidae)
              Genus: "×—×ª×•×œ", // (Felis)
              Species: "×—×ª×•×œ ×‘×¨", // (Felis catus)
            },
          },
          options: [
            {
              name: "×–×‘×“ ××¤×¨×™×§××™",
              image: "images/civet.jpg",
              taxonomy: {
                Kingdom: "×‘×¢×œ×™ ×—×™×™×",
                Phylum: "××™×ª×¨× ×™×™×",
                Class: "×™×•× ×§×™×",
                Order: "×˜×•×¨×¤×™×", // (Squamata)
                Family: "×’×—× ×™×™×", // (Varanidae)
                Genus: "Civettictis", // (Varanus)
                Species: "×–×‘×“ ××¤×¨×™×§× ×™", // ×“×•×’××” ×›×œ×œ×™×ª ×œ×œ×˜××ª ×›×•×—
              },
            },
            {
              name: "×¡×¨×•×•××œ",
              correct: true,
              image: "images/serval.jpg",
              taxonomy: {
                Kingdom: "×‘×¢×œ×™ ×—×™×™×",
                Phylum: "××™×ª×¨× ×™×™×",
                Class: "×™×•× ×§×™×",
                Order: "×˜×•×¨×¤×™×", // (Squamata)
                Family: "×—×ª×•×œ×™×™×", // (Varanidae)
                Genus: "×¡×¨×•×•××œ", // (Varanus)
                Species: "×¡×¨×•×•××œ", // ×“×•×’××” ×›×œ×œ×™×ª ×œ×œ×˜××ª ×›×•×—
              },
            },
            {
              name: "×¤×•×¡×”",
              image: "images/fossa.jpg",
              taxonomy: {
                Kingdom: "×‘×¢×œ×™ ×—×™×™×",
                Phylum: "××™×ª×¨× ×™×™×",
                Class: "×™×•× ×§×™×",
                Order: "×˜×•×¨×¤×™×", // (Squamata)
                Family: "×˜×•×¨×¤×™ ××“×’×¡×§×¨", // (Varanidae)
                Genus: "×¤×•×¡×”", // (Varanus)
                Species: "×¤×•×¡×”", // ×“×•×’××” ×›×œ×œ×™×ª ×œ×œ×˜××ª ×›×•×—
              },
            },
          ],
          explanation:
            "×™×•× ×” ×§×¨×•×‘×” ×™×•×ª×¨ ×œ×“×™× ×•×–××•×¨ ×××©×¨ ×œ×˜××ª ×›×•×— ××• ×ª× ×™×Ÿ, ×”×•×“×•×ª ×œ×§×¨×‘×” ××‘×•×œ×•×¦×™×•× ×™×ª.",
        },

        // 4) ×§×¨× ×£
        {
          mainAnimal: {
            name: "×§×¨× ×£",
            image: "images/rhino.jpg",
            taxonomy: {
              Kingdom: "×‘×¢×œ×™ ×—×™×™×",
              Phylum: "××™×ª×¨× ×™×™×",
              Class: "×™×•× ×§×™×",
              Order: "××¤×¨×™×˜×™ ×¤×¨×¡×”", // (Perissodactyla)
              Family: "×§×¨× ×¤×™×™×", // (Rhinocerotidae)
              Genus: "×§×¨× ×£", // (Rhinoceros)
              Species: "×§×¨× ×£ ×”×•×“×™", // (Rhinoceros unicornis)
            },
          },
          options: [
            {
              name: "×¤×™×œ",
              image: "images/elephant.jpg",
              taxonomy: {
                Kingdom: "×‘×¢×œ×™ ×—×™×™×",
                Phylum: "××™×ª×¨× ×™×™×",
                Class: "×™×•× ×§×™×",
                Order: "×—×“×§××™×", // (Proboscidea)
                Family: "×¤×™×œ×™×™×", // (Elephantidae)
                Genus: "×¤×™×œ", // (Elephas)
                Species: "×¤×™×œ ××¡×™×™×ª×™", // (Elephas maximus)
              },
            },
            {
              name: "×”×™×¤×•×¤×•×˜×",
              image: "images/hippo.jpg",
              taxonomy: {
                Kingdom: "×‘×¢×œ×™ ×—×™×™×",
                Phylum: "××™×ª×¨× ×™×™×",
                Class: "×™×•× ×§×™×",
                Order: "××›×¤×™×œ×™ ×¤×¨×¡×”", // (Artiodactyla)
                Family: "×”×™×¤×•×¤×•×˜××™×™×", // (Hippopotamidae)
                Genus: "×”×™×¤×•×¤×•×˜×", // (Hippopotamus)
                Species: "×”×™×¤×•×¤×•×˜× ××¦×•×™", // (Hippopotamus amphibius)
              },
            },
            {
              name: "×¡×•×¡",
              image: "images/horse.jpg",
              correct: true,
              taxonomy: {
                Kingdom: "×‘×¢×œ×™ ×—×™×™×",
                Phylum: "××™×ª×¨× ×™×™×",
                Class: "×™×•× ×§×™×",
                Order: "××¤×¨×™×˜×™ ×¤×¨×¡×”", // (Perissodactyla)
                Family: "×¡×•×¡×™×™×", // (Equidae)
                Genus: "×¡×•×¡", // (Equus)
                Species: "×¡×•×¡ ×”×‘×™×ª", // (Equus ferus caballus)
              },
            },
          ],
          explanation:
            "×¡×•×¡ ×§×¨×•×‘ ×™×•×ª×¨ ×œ×§×¨× ×£ ×××©×¨ ×œ×¤×™×œ ××• ×œ×”×™×¤×•×¤×•×˜× ××‘×—×™× ×” ××‘×•×œ×•×¦×™×•× ×™×ª.",
        },

        // 5) ×¡×œ×× ×“×¨×”
        {
          mainAnimal: {
            name: "×¡×œ×× ×“×¨×”",
            image: "images/salamander.jpg",
            taxonomy: {
              Kingdom: "×‘×¢×œ×™ ×—×™×™×",
              Phylum: "××™×ª×¨× ×™×™×",
              Class: "×“×•-×—×™×™×",
              Order: "×‘×¢×œ×™ ×–× ×‘", // (Caudata)
              Family: "×××‘×™×¡×˜×•××™×™×", // (Ambystomatidae)
              Genus: "×××‘×™×¡×˜×•××”", // (Ambystoma)
              Species: "×××‘×™×¡×˜×•××” ××§×¡×™×§× ×™×ª", // Axolotl ×›×“×•×’××”
            },
          },
          options: [
            {
              name: "×§×¨×¤×“×”",
              image: "images/toad.jpg",
              correct: true,
              taxonomy: {
                Kingdom: "×‘×¢×œ×™ ×—×™×™×",
                Phylum: "××™×ª×¨× ×™×™×",
                Class: "×“×•-×—×™×™×",
                Order: "×—×¡×¨×™ ×–× ×‘", // (Anura)
                Family: "×§×¨×¤×“×™×™×", // (Bufonidae)
                Genus: "×§×¨×¤×“×”", // (Bufo)
                Species: "×§×¨×¤×“×” ××¦×•×™×”", // (Bufo bufo)
              },
            },
            {
              name: "×–×™×§×™×ª",
              image: "images/chameleon.jpg",
              taxonomy: {
                Kingdom: "×‘×¢×œ×™ ×—×™×™×",
                Phylum: "××™×ª×¨× ×™×™×",
                Class: "×–×•×—×œ×™×",
                Order: "×§×©×§×©××™×", // (Squamata)
                Family: "×–×™×§×™×ª×™×™×", // (Chamaeleonidae)
                Genus: "×–×™×§×™×ª",
                Species: "×–×™×§×™×ª ×¦×¢×™×¤×”", // (Chamaeleo calyptratus)
              },
            },
            {
              name: "×©×××™×ª",
              image: "images/gecko.jpg",
              taxonomy: {
                Kingdom: "×‘×¢×œ×™ ×—×™×™×",
                Phylum: "××™×ª×¨× ×™×™×",
                Class: "×–×•×—×œ×™×",
                Order: "×§×©×§×©××™×",
                Family: "×©×××™×ª×™×™×", // (Gekkonidae)
                Genus: "×©×××™×ª",
                Species: "×©×××™×ª ××¦×•×™×”", // ×“×•×’××” ×›×œ×œ×™×ª
              },
            },
          ],
          explanation:
            "×¡×œ×× ×“×¨×” ×§×¨×•×‘×” ×™×•×ª×¨ ×œ×§×¨×¤×“×” ×××©×¨ ×œ×–×™×§×™×ª ××• ×©×××™×ª ××‘×—×™× ×” ××‘×•×œ×•×¦×™×•× ×™×ª.",
        },

        // 6) ××•×§×¤×™
        {
          mainAnimal: {
            name: "××•×§×¤×™",
            image: "images/okapi.jpg",
            taxonomy: {
              Kingdom: "×‘×¢×œ×™ ×—×™×™×",
              Phylum: "××™×ª×¨× ×™×™×",
              Class: "×™×•× ×§×™×",
              Order: "××›×¤×™×œ×™ ×¤×¨×¡×”", // (Artiodactyla)
              Family: "×’'×™×¨×¤×™×™×", // (Giraffidae)
              Genus: "××•×§×¤×™×”", // (Okapia)
              Species: "××•×§×¤×™×” ×’'×•× ×¡×˜×•× ×™", // (Okapia johnstoni)
            },
          },
          options: [
            {
              name: "×–×‘×¨×”",
              image: "images/zebra.jpg",
              taxonomy: {
                Kingdom: "×‘×¢×œ×™ ×—×™×™×",
                Phylum: "××™×ª×¨× ×™×™×",
                Class: "×™×•× ×§×™×",
                Order: "××¤×¨×™×˜×™ ×¤×¨×¡×”", // (Perissodactyla)
                Family: "×¡×•×¡×™×™×", // (Equidae)
                Genus: "×¡×•×¡", // (Equus)
                Species: "×–×‘×¨×” ××¦×•×™×”", // (Equus quagga)
              },
            },
            {
              name: "×’'×™×¨×¤×”",
              image: "images/giraffe.jpg",
              correct: true,
              taxonomy: {
                Kingdom: "×‘×¢×œ×™ ×—×™×™×",
                Phylum: "××™×ª×¨× ×™×™×",
                Class: "×™×•× ×§×™×",
                Order: "××›×¤×™×œ×™ ×¤×¨×¡×”",
                Family: "×’'×™×¨×¤×™×™×",
                Genus: "×’'×™×¨×¤×”",
                Species: "×’'×™×¨×£ ××¦×•×™", // (Giraffa camelopardalis)
              },
            },
            {
              name: "×˜×¤×™×¨ ××¡×™×™×ª×™",
              image: "images/tapir.jpg",
              taxonomy: {
                Kingdom: "×‘×¢×œ×™ ×—×™×™×",
                Phylum: "××™×ª×¨× ×™×™×",
                Class: "×™×•× ×§×™×",
                Order: "××¤×¨×™×˜×™ ×¤×¨×¡×”",
                Family: "×˜×¤×™×¨×™×™×", // (Tapiridae)
                Genus: "×˜×¤×™×¨", // (Tapirus)
                Species: "×˜×¤×™×¨ ××¡×™×™×ª×™", // (Tapirus indicus)
              },
            },
          ],
          explanation:
            "×’'×™×¨×¤×” ×§×¨×•×‘×” ×™×•×ª×¨ ×œ××•×§×¤×™ ×××©×¨ ×œ×–×‘×¨×” ××• ×˜×¤×™×¨ ××¡×™×™×ª×™, ××›×™×•×•×Ÿ ×©×©× ×™×”× ×©×™×™×›×™× ×œ××©×¤×—×ª ×’'×™×¨×¤×™×™×.",
        },

        // 7) ×“×•×¨×‘×Ÿ
        {
          mainAnimal: {
            name: "×“×•×¨×‘×Ÿ",
            image: "images/hystrix_indica.jpg",
            taxonomy: {
              Kingdom: "×‘×¢×œ×™ ×—×™×™×",
              Phylum: "××™×ª×¨× ×™×™×",
              Class: "×™×•× ×§×™×",
              Order: "××›×¨×¡××™×",
              Family: "×“×•×¨×‘× ×™×™×", // (Hyaenidae)
              Genus: "×“×•×¨×‘×Ÿ", // (Crocuta/Hyaena) â€“ ×›××Ÿ ×¤×©×•×˜ "×¦×‘×•×¢"
              Species: "×“×•×¨×‘×Ÿ ××¦×•×™", // (Crocuta crocuta)
            },
          },
          options: [
            {
              name: "×§×™×¤×•×“",
              image: "images/hedgehog.jpg",
              taxonomy: {
                Kingdom: "×‘×¢×œ×™ ×—×™×™×",
                Phylum: "××™×ª×¨× ×™×™×",
                Class: "×™×•× ×§×™×",
                Order: "××•×›×œ×™ ×—×¨×§×™×",
                Family: "×§×™×¤×•×“×™×™×", // (Canidae)
                Genus: "×§×™×¤×•×“", // (Canis)
                Species: "×§×™×¤×•×“ ××¦×•×™", // (Canis aureus)
              },
            },
            {
              name: "××•×’×¨",
              image: "images/hamster.jpg",
              correct: true,
              taxonomy: {
                Kingdom: "×‘×¢×œ×™ ×—×™×™×",
                Phylum: "××™×ª×¨× ×™×™×",
                Class: "×™×•× ×§×™×",
                Order: "××›×¨×¡××™×",
                Family: "××•×’×¨×™×™×", // (Herpestidae)
                Genus: "××•×’×¨", // (Helogale)
                Species: "××•×’×¨ ×–×”×•×‘", // (Helogale parvula)
              },
            },
            {
              name: "×’×™×¨×™×ª ×“×‘×©",
              image: "images/honeybadger.jpg",
              taxonomy: {
                Kingdom: "×‘×¢×œ×™ ×—×™×™×",
                Phylum: "××™×ª×¨× ×™×™×",
                Class: "×™×•× ×§×™×",
                Order: "×˜×•×¨×¤×™×",
                Family: "×¡××•×¨×™×™×", // (Mustelidae)
                Genus: "×’×™×¨×™×•×ª ×“×‘×©", // (Mellivora)
                Species: "×’×™×¨×™×ª ×”×“×‘×©", // (Mellivora capensis)
              },
            },
          ],
          explanation:
            "× ××™×™×” × × ×¡×™×ª ×§×¨×•×‘×” ×™×•×ª×¨ ×œ×¦×‘×•×¢ ×××©×¨ ×œ×’×™×¨×™×ª ×“×‘×© ××• ×ª×Ÿ ××‘×—×™× ×” ××‘×•×œ×•×¦×™×•× ×™×ª.",
        },

        // 8) ×§×™×¤×•×“ ×™×
        {
          mainAnimal: {
            name: "×§×™×¤×•×“ ×™×",
            image: "images/tripneustes.jpg",
            taxonomy: {
              Kingdom: "×‘×¢×œ×™ ×—×™×™×",
              Phylum: "×§×•×•×¦×™ ×¢×•×¨",
              Class: "×§×™×¤×•×“×™ ×™×",
              Order: "Camarodonta",
              Family: "Toxopneustidae",
              Genus: "Tripneustes",
              Species: "Tripneustes ventricosus",
            },
          },
          options: [
            {
              name: "××œ×¤×¤×•×Ÿ ×™×",
              image: "images/polycheira_rufescens.jpg",
              correct: true,
              taxonomy: {
                Kingdom: "×‘×¢×œ×™ ×—×™×™×",
                Phylum: "×§×•×•×¦×™ ×¢×•×¨",
                Class: "Holothuroidea",
                Order: "Apodida",
                Family: "Chiridotidae",
                Genus: "Polycheira",
                Species: "Polycheira rufescens",
              },
            },
            {
              name: "×§×™×¤×•×“",
              image: "images/hedgehog.jpg",
              taxonomy: {
                Kingdom: "×‘×¢×œ×™ ×—×™×™×",
                Phylum: "××™×ª×¨× ×™×™×",
                Class: "×™×•× ×§×™×",
                Order: "××•×›×œ×™ ×—×¨×§×™×",
                Family: "×§×™×¤×•×“×™×™×", // (Canidae)
                Genus: "×§×™×¤×•×“", // (Canis)
                Species: "×§×™×¤×•×“ ××¦×•×™", // (Canis aureus)
              },
            },
            {
              name: "×¡×¤×•×’ ×™×",
              image: "images/aplysina_archeri.jpg",
              taxonomy: {
                Kingdom: "×‘×¢×œ×™ ×—×™×™×",
                Phylum: "×¡×¤×•×’×™×",
                Class: "×¡×¤×•×’× ×™×",
                Order: "Verongiida",
                Family: "Aplysinidae", // (Muridae)
                Genus: "Aplysina",
                Species: "Aplysina archeri", // (Mus musculus)
              },
            },
          ],
          explanation:
            "×—×“×£ ×¤×™×œ (Elephant Shrew) ×§×¨×•×‘ ×™×•×ª×¨ ×œ×¤×™×œ ×××©×¨ ×œ×¢×›×‘×¨ ××• ××•×’×¨ ××‘×—×™× ×” ××‘×•×œ×•×¦×™×•× ×™×ª, ×©×›×Ÿ ×”×•× × ×× ×” ×¢×œ ×§×‘×•×¦×ª ×”××¤×¨×•×ª×¨×™×”.",
        },
      ];

      let currentQuestion = 0;
      let scores = { a: 0, b: 0 };
      let selections = { a: null, b: null };

      // Initialize mermaid
      mermaid.initialize({
        startOnLoad: true,
        theme: "base",
        themeVariables: {
          primaryColor: "#4F46E5",
          primaryTextColor: "#fff",
          primaryBorderColor: "#4F46E5",
          lineColor: "#94A3B8",
          secondaryColor: "#6366F1",
          tertiaryColor: "#818CF8",
        },
        flowchart: {
          useMaxWidth: true,
          htmlLabels: true,
          curve: "basis",
          rankSpacing: 80,
          nodeSpacing: 50,
          padding: 20,
        },
      });

      // Function to generate enhanced taxonomy diagram
      function generateTaxonomyDiagram(mainAnimal, options) {
        // Start a left-to-right flowchart
        let diagram = "graph LR\n";

        // Define your custom classes with enhanced styling
        diagram += `
%% === Classes (Styling) ===
classDef kingdomStyle fill:#4F46E5,stroke:#4F46E5,color:#fff,stroke-width:2px;
classDef phylumStyle fill:#6366F1,stroke:#6366F1,color:#fff,stroke-width:2px;
classDef classStyle fill:#818CF8,stroke:#818CF8,color:#fff,stroke-width:2px;
classDef orderStyle fill:#A5B4FC,stroke:#A5B4FC,color:#1E293B,stroke-width:2px;
classDef familyStyle fill:#C7D2FE,stroke:#C7D2FE,color:#1E293B,stroke-width:2px;
classDef genusStyle fill:#E0E7FF,stroke:#E0E7FF,color:#1E293B,stroke-width:2px;
classDef speciesStyle fill:#FF6B6B,stroke:#FF6B6B,color:#1E293B,stroke-width:2px;
classDef sharedStyle fill:#22C55E,stroke:#22C55E,color:#fff,stroke-width:3px;
classDef mainAnimalStyle stroke:#121157,color:#fff,stroke-width:3px;
classDef correctAnswerStyle fill:#4CAF50,stroke:#227025,color:#fff,stroke-width:3px;
`;

        const taxonomyLevels = [
          { key: "Kingdom", hebrew: "×××œ×›×”", style: "kingdomStyle" },
          { key: "Phylum", hebrew: "××¢×¨×›×”", style: "phylumStyle" },
          { key: "Class", hebrew: "××—×œ×§×”", style: "classStyle" },
          { key: "Order", hebrew: "×¡×“×¨×”", style: "orderStyle" },
          { key: "Family", hebrew: "××©×¤×—×”", style: "familyStyle" },
          { key: "Genus", hebrew: "×¡×•×’", style: "genusStyle" },
          { key: "Species", hebrew: "××™×Ÿ", style: "speciesStyle" },
        ];

        // Main animal path
        const mainPrefix = "main";
        taxonomyLevels.forEach((level, i) => {
          const labelValue =
            level.key === "Species"
              ? mainAnimal.name
              : mainAnimal.taxonomy[level.key];

          // Add special styling for main animal's species
          if (level.key === "Species") {
            diagram += `${mainPrefix}${level.key}["ğŸ” <b>${level.hebrew}</b><br>${labelValue}"]:::mainAnimalStyle\n`;
          } else {
            diagram += `${mainPrefix}${level.key}["<b>${level.hebrew}</b><br>${labelValue}"]:::${level.style}\n`;
          }

          if (i > 0) {
            diagram += `${mainPrefix}${
              taxonomyLevels[i - 1].key
            } --> ${mainPrefix}${level.key}\n`;
          }
        });

        // Option paths
        options.forEach((option, index) => {
          const prefix = `opt${index}`;
          let lastSharedIndex = 0;

          // Find last shared taxonomy level
          taxonomyLevels.forEach((level, i) => {
            const mainValue =
              level.key === "Species"
                ? mainAnimal.name
                : mainAnimal.taxonomy[level.key];
            const optValue =
              level.key === "Species"
                ? option.name
                : option.taxonomy[level.key];
            if (optValue === mainValue) lastSharedIndex = i;
          });

          // Build option paths
          taxonomyLevels.forEach((level, i) => {
            const optValue = option.taxonomy[level.key];

            if (i <= lastSharedIndex) {
              diagram += `class ${mainPrefix}${level.key} sharedStyle;\n`;
            } else {
              // Add special styling for correct answer's species
              if (level.key === "Species" && option.correct) {
                diagram += `${prefix}${level.key}["âœ… <b>${level.hebrew}</b><br>${optValue}"]:::correctAnswerStyle\n`;
              } else {
                diagram += `${prefix}${level.key}["<b>${level.hebrew}</b><br>${optValue}"]:::${level.style}\n`;
              }

              if (i === lastSharedIndex + 1) {
                diagram += `${mainPrefix}${taxonomyLevels[lastSharedIndex].key} --> ${prefix}${level.key}\n`;
              } else {
                diagram += `${prefix}${
                  taxonomyLevels[i - 1].key
                } --> ${prefix}${level.key}\n`;
              }
            }
          });
        });

        return diagram;
      }

      const updateUI = () => {
        const question = quizData[currentQuestion];

        document.getElementById("main-animal-name").textContent =
          question.mainAnimal.name;
        document.getElementById("main-animal-img").src =
          question.mainAnimal.image;

        const optionsContainer = document.getElementById("options-container");
        optionsContainer.innerHTML = "";

        question.options.forEach((option, index) => {
          const optionElement = document.createElement("div");
          optionElement.className = "option";
          optionElement.innerHTML = `
              <div class="team-label">×§×‘×•×¦×”</div>
              <img src="${option.image}" alt="${option.name}">
              <h3>${option.name}</h3>
            `;
          // Attach our modified select function
          optionElement.addEventListener("click", () => selectOption(index));
          optionsContainer.appendChild(optionElement);
        });

        document.getElementById("current-question").textContent =
          currentQuestion + 1;
        document.getElementById("total-questions").textContent =
          quizData.length;

        document.getElementById("reveal-btn").disabled = true;
        document.getElementById("next-btn").disabled = true;

        // Reset selections for this round
        selections = { a: null, b: null };

        // Hide explanation section
        document.getElementById("explanation-container").style.display = "none";

        // remove scores-updated class from team elements
        document.querySelectorAll(".team").forEach((team) => {
          team.classList.remove("score-updated");
        });
      };

      /**
       * Modified selectOption() that allows:
       * 1) Toggling (deselecting) a choice for each team.
       * 2) Both teams can choose the same option.
       */
      const selectOption = (index) => {
        const options = document.querySelectorAll(".option");
        const option = options[index];
        const teamLabel = option.querySelector(".team-label");

        // CASE 1: If Team A hasn't picked yet, select for A
        if (selections.a === null) {
          selections.a = index;
          option.classList.add("selected-a");
          teamLabel.textContent = "×§×‘×•×¦×” ××³";
          teamLabel.style.opacity = "1";
        }

        // CASE 2: If Team A already picked but Team B hasn't, pick for B
        else if (selections.b === null) {
          selections.b = index;
          option.classList.add("selected-b");
          teamLabel.textContent = "×§×‘×•×¦×” ×‘×³";
          teamLabel.style.opacity = "1";
        }

        // CASE 3: Both teams have selections, so handle toggling/deselecting
        else {
          // If both teams picked the same option, clicking it again removes it from both
          if (selections.a === index && selections.b === index) {
            selections.a = null;
            selections.b = null;
            option.classList.remove("selected-a", "selected-b", "shared");
            teamLabel.style.opacity = "0";
          }
          // If only Team A picked this option, toggle off A
          else if (selections.a === index) {
            selections.a = null;
            option.classList.remove("selected-a");
            // If B did not also pick it, hide label
            if (selections.b !== index) {
              teamLabel.style.opacity = "0";
            }
          }
          // If only Team B picked this option, toggle off B
          else if (selections.b === index) {
            selections.b = null;
            option.classList.remove("selected-b");
            // If A did not also pick it, hide label
            if (selections.a !== index) {
              teamLabel.style.opacity = "0";
            }
          }
          // If we got here, it means user clicked a completely different option
          // while both teams had selections. For simplicity, do nothing or
          // replace one team's choice. (This is up to you!)
        }

        // Handle the .shared class if both ended up on the same selection
        // after the above logic
        if (selections.a === index && selections.b === index) {
          option.classList.add("shared");
          teamLabel.textContent = "2 ×”×§×‘×•×¦×•×ª";
        } else {
          option.classList.remove("shared");
        }

        // Enable "Reveal" button only if both teams have made a selection
        document.getElementById("reveal-btn").disabled =
          selections.a === null || selections.b === null;
      };

      const revealAnswer = () => {
        const question = quizData[currentQuestion];
        const options = document.querySelectorAll(".option");
        const correctIndex = question.options.findIndex(
          (option) => option.correct
        );

        options.forEach((option, index) => {
          if (index === correctIndex) {
            option.classList.add("correct");
          } else if (selections.a === index || selections.b === index) {
            option.classList.add("incorrect");
          }
        });

        if (selections.a === correctIndex) scores.a++;
        if (selections.b === correctIndex) scores.b++;

        document.getElementById("score-a").textContent = scores.a;
        document.getElementById("score-b").textContent = scores.b;

        if (selections.a === correctIndex) {
          document.querySelector(`.team-a`).classList.add("score-updated");
        }
        if (selections.b === correctIndex) {
          document.querySelector(`.team-b`).classList.add("score-updated");
        }

        // Display explanation
        const diagram = generateTaxonomyDiagram(
          question.mainAnimal,
          question.options
        );
        const diagramContainer = document.getElementById("taxonomy-diagram");
        diagramContainer.innerHTML = `<pre class="mermaid">${diagram}</pre>`;
        mermaid.init(undefined, diagramContainer.querySelector(".mermaid"));

        // Also prepare the fullscreen diagram
        const fullscreenDiagramContainer = document.getElementById(
          "fullscreen-taxonomy-diagram"
        );
        fullscreenDiagramContainer.innerHTML = `<pre class="mermaid">${diagram}</pre>`;
        mermaid.init(
          undefined,
          fullscreenDiagramContainer.querySelector(".mermaid")
        );

        document.getElementById("explanation-container").style.display =
          "block";

        document.getElementById("reveal-btn").disabled = true;
        document.getElementById("next-btn").disabled = false;
      };

      const nextQuestion = () => {
        currentQuestion++;
        if (currentQuestion >= quizData.length) {
          showFinalScreen();
        } else {
          updateUI();
        }
      };

      const showFinalScreen = () => {
        const finalScreen = document.getElementById("final-screen");
        const finalMessage = document.getElementById("final-message");
        const finalScores = document.getElementById("final-scores");

        // Determine the winner
        let message = "";
        if (scores.a > scores.b) {
          message = "×§×‘×•×¦×” ××³ × ×™×¦×—×”!";
        } else if (scores.b > scores.a) {
          message = "×§×‘×•×¦×” ×‘×³ × ×™×¦×—×”!";
        } else {
          message = "×ª×™×§×•!";
        }

        finalMessage.textContent = message;
        finalScores.textContent = `×§×‘×•×¦×” ××³: ${scores.a} × ×§×•×“×•×ª | ×§×‘×•×¦×” ×‘×³: ${scores.b} × ×§×•×“×•×ª`;

        // Add thank-you paragraph
        const thankYouMessage = document.createElement("p");
        thankYouMessage.textContent = `
        ×ª×•×“×” ×¨×‘×” ×¢×œ ×”×©×ª×ª×¤×•×ª×›× ×‘×—×™×“×•×Ÿ ×”×˜×§×¡×•× ×•××™×” ×©×œ× ×•! ×”×—×™×“×•×Ÿ × ×•×¢×“ ×œ×”×“×’×™×© ×›×™ ×œ×¢×™×ª×™× ×§×¨×•×‘×•×ª, ×“××™×•×Ÿ ×—×™×¦×•× ×™ ×‘×™×Ÿ ×‘×¢×œ×™ ×—×™×™× ××™× ×• ××¢×™×“ ×¢×œ ×§×¨×‘×” ×˜×§×¡×•× ×•××™×ª ×××™×ª×™×ª. ××˜×¨×ª× ×• ×”×™×™×ª×” ×œ×”×¢××™×§ ××ª ×”×”×‘× ×” ×©×œ×›× ×‘×™×—×¡×™× ×”××‘×•×œ×•×¦×™×•× ×™×™× ×‘×™×Ÿ ××™× ×™× ×©×•× ×™× ×•×œ×”××—×™×© ×©××¨××” ×—×™×¦×•× ×™ ××™× ×• ×‘×”×›×¨×— ××©×§×£ ××ª ×”×§×¨×‘×” ×”×‘×™×•×œ×•×’×™×ª. ×× ×• ××§×•×•×™× ×©×”×—×™×“×•×Ÿ ×ª×¨× ×œ×”×‘× ×ª×›× ×©×œ ×”×¡×“×¨ ×”×”×™×¨×¨×›×™ ×‘×˜×§×¡×•× ×•××™×” ×•××ª ×—×©×™×‘×•×ª ×”×¡×™×•×•×’ ×”××“×¢×™ ×”××“×•×™×§. ×”××©×™×›×• ×œ×’×œ×•×ª ×•×œ×œ××•×“ ×¢×œ ×”××’×•×•×Ÿ ×”×¢×©×™×¨ ×•×”××¨×ª×§ ×©×œ ×¢×•×œ× ×”×—×™ ×©×¡×‘×™×‘× ×•!
`;
        thankYouMessage.style.marginTop = "1rem";
        thankYouMessage.style.fontSize = "1.25rem";
        thankYouMessage.style.textAlign = "center";
        thankYouMessage.style.width = "80%";
        thankYouMessage.style.color = "#94a3b8";
        finalScreen.appendChild(thankYouMessage);

        finalScreen.style.display = "flex";

        // Trigger confetti for 30 seconds
        const duration = 30 * 1000;
        const confettiInterval = 500;
        const end = Date.now() + duration;

        const confettiLoop = setInterval(() => {
          confetti({
            particleCount: 50,
            angle: 60,
            spread: 100,
            origin: { x: 0 },
            zIndex: 1000,
          });

          confetti({
            particleCount: 50,
            angle: 120,
            spread: 100,
            origin: { x: 1 },
            zIndex: 1000,
          });

          if (Date.now() > end) {
            clearInterval(confettiLoop);
            confetti.reset();
          }
        }, confettiInterval);
      };

      const restartQuiz = () => {
        // Reset scores and question index
        currentQuestion = 0;
        scores = { a: 0, b: 0 };
        selections = { a: null, b: null };

        // Update scores in UI
        document.getElementById("score-a").textContent = scores.a;
        document.getElementById("score-b").textContent = scores.b;

        // Hide final screen
        document.getElementById("final-screen").style.display = "none";

        // Update UI for the first question
        updateUI();
      };

      const finishQuiz = () => {
        showFinalScreen();
      };

      document
        .getElementById("reveal-btn")
        .addEventListener("click", revealAnswer);
      document
        .getElementById("next-btn")
        .addEventListener("click", nextQuestion);
      document
        .getElementById("restart-btn")
        .addEventListener("click", restartQuiz);

      document
        .getElementById("finish-btn")
        .addEventListener("click", finishQuiz);

      // Modal Functionality
      const modal = document.getElementById("diagram-modal");
      const openModalBtn = document.getElementById("view-fullscreen-btn");
      const closeModalSpan = document.getElementsByClassName("close-modal")[0];

      // When the user clicks the button, open the modal
      openModalBtn.addEventListener("click", () => {
        modal.style.display = "flex"; // Show the modal

        // Ensure Mermaid renders the diagram after the modal is visible
        const fullscreenDiagramContainer = document.getElementById(
          "fullscreen-taxonomy-diagram"
        );

        // Clear any existing content to avoid duplication
        fullscreenDiagramContainer.innerHTML = "";

        // Regenerate the diagram content
        const question = quizData[currentQuestion];
        const diagram = generateTaxonomyDiagram(
          question.mainAnimal,
          question.options
        );

        // Add the Mermaid content to the modal
        fullscreenDiagramContainer.innerHTML = `<pre class="mermaid">${diagram}</pre>`;

        mermaid.init(
          undefined,
          fullscreenDiagramContainer.querySelectorAll(".mermaid")
        );
      });

      // When the user clicks on <span> (x), close the modal
      closeModalSpan.onclick = function () {
        modal.style.display = "none";
      };

      // When the user clicks anywhere outside of the modal content, close it
      window.onclick = function (event) {
        if (event.target == modal) {
          modal.style.display = "none";
        }
      };

      updateUI();
    </script>
  </body>
</html>
