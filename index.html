<!DOCTYPE html>
<html dir="rtl" lang="he">
  <head>
    <meta charset="UTF-8" />
    <title>חידון טקסונומיה</title>
    <!-- Include Confetti.js via CDN -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Rubik:wght@400;500;600;700&display=swap");

      body {
        font-family: "Rubik", "Inter", system-ui, sans-serif;
        margin: 0;
        padding: 2rem;
        min-height: 100vh;
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
        color: #f8fafc;
        line-height: 1.5;
        direction: rtl;
      }

      .slide {
        max-width: 1000px;
        margin: 0 auto;
        padding: 2.5rem;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 24px;
        backdrop-filter: blur(12px);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
      }

      .header {
        text-align: center;
        margin-bottom: 1rem;
      }

      .title {
        font-size: 3rem;
        font-weight: 700;
        margin: 0;
        background: linear-gradient(135deg, #60a5fa, #a78bfa);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .subtitle {
        font-size: 1.25rem;
        color: #94a3b8;
      }

      .scores {
        display: flex;
        justify-content: center;
        gap: 2rem;
      }

      .team {
        padding: 1rem 2rem;
        border-radius: 16px;
        font-weight: 600;
        min-width: 150px;
        text-align: center;
        transition: transform 0.2s;
      }

      .team:hover {
        transform: translateY(-2px);
      }

      .team-a {
        background: linear-gradient(
          135deg,
          rgb(255, 105, 180, 0.2),
          rgba(255, 105, 180, 0.1)
        );
        border: 1px solid rgba(255, 105, 180, 0.4);
      }

      .team-b {
        background: linear-gradient(
          135deg,
          rgba(59, 130, 246, 0.2),
          rgba(59, 130, 246, 0.1)
        );
        border: 1px solid rgba(59, 130, 246, 0.2);
      }

      .main-content {
        margin: 1rem 0;
      }

      .target-animal {
        text-align: center;
        padding: 0.5rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 20px;
      }

      .target-animal img {
        width: 400px;
        height: 260px;
        object-fit: cover;
        border-radius: 16px;
        margin-bottom: 1.5rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      }

      .target-animal h2 {
        font-size: 2rem;
        margin: 0;
        color: #f8fafc;
      }

      .options {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 2rem;
        margin-top: 1rem;
      }

      .option {
        position: relative;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 16px;
        padding: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .option:hover {
        transform: translateY(-4px);
        background: rgba(255, 255, 255, 0.08);
      }

      .option img {
        width: 100%;
        height: 200px;
        object-fit: cover;
        border-radius: 12px;
        margin-bottom: 1rem;
      }

      .option h3 {
        margin: 0;
        font-size: 1.25rem;
        text-align: center;
      }

      .team-label {
        position: absolute;
        top: -12px;
        right: 50%;
        transform: translateX(50%);
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.875rem;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .selected-a {
        border: 2px solid #ff69b4;
      }

      .selected-a .team-label {
        background: #ff69b4;
        opacity: 1;
      }

      .selected-b {
        border: 2px solid #3b82f6;
      }

      .selected-b .team-label {
        background: #3b82f6;
        opacity: 1;
      }

      .shared .team-label {
        background: #fbbf24;
        color: #000;
      }

      .option.correct {
        border: 2px solid #ff69b4;
        animation: correctPulse 2s infinite;
      }

      .option.incorrect {
        border: 2px solid #ef4444;
        background: rgba(239, 68, 68, 0.2);
        opacity: 0.5;
      }

      .option.shared {
        border: 3px dashed #fbbf24;
        background: rgba(251, 191, 36, 0.2);
      }

      .controls {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-top: 3rem;
      }

      button {
        padding: 0.875rem 2rem;
        border: none;
        border-radius: 12px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        background: rgba(255, 255, 255, 0.1);
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      button:not(:disabled):hover {
        transform: translateY(-2px);
        background: rgba(255, 255, 255, 0.15);
      }

      button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .footer {
        text-align: center;
        margin-top: 2rem;
        color: #94a3b8;
        font-size: 0.875rem;
      }

      .explanation {
        margin-top: 2rem;
        padding: 1rem;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 16px;
        display: none;
      }

      .explanation h3 {
        margin: 0 0 0.5rem 0;
        font-size: 1.25rem;
      }

      .explanation p {
        margin: 0;
        font-size: 1rem;
        color: #d1d5db;
      }

      /* Final Screen Styles */
      .final-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(15, 23, 42, 0.95);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: #f8fafc;
        z-index: 1000;
        display: none; /* Hidden by default */
      }

      .final-screen h2 {
        font-size: 2.5rem;
        margin-bottom: 1rem;
        background: linear-gradient(135deg, #f472b6, #60a5fa);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .final-screen p {
        font-size: 1.5rem;
        margin: 0.5rem 0;
      }

      .final-screen button {
        margin-top: 2rem;
        padding: 0.875rem 2rem;
        border: none;
        border-radius: 12px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        background: #3b82f6;
        color: white;
      }

      .final-screen button:hover {
        background: #2563eb;
      }

      @keyframes correctPulse {
        0%,
        100% {
          background: rgba(34, 197, 94, 0.4);
          box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4);
        }
        50% {
          background: rgba(34, 197, 94, 0.1);
          box-shadow: 0 0 0 10px rgba(34, 197, 94, 0);
        }
      }
    </style>
  </head>
  <body>
    <div class="slide">
      <div class="header">
        <h1 class="title">חידון טקסונומיה - מבוא לביולוגיה לתלמידי מדעים</h1>
        <div class="subtitle">איזו חיה קרובה ביותר מבחינה אבולוציונית?</div>
      </div>

      <div class="main-content">
        <div class="target-animal">
          <img id="main-animal-img" alt="חיה ראשית" />
          <h2 id="main-animal-name"></h2>
        </div>

        <div class="options" id="options-container"></div>

        <!-- Explanation Section -->
        <div class="explanation" id="explanation-container">
          <h3>הסבר:</h3>
          <p id="explanation-text"></p>
        </div>
      </div>

      <div class="scores">
        <div class="team team-a">קבוצה א׳: <span id="score-a">0</span></div>
        <div class="team team-b">קבוצה ב׳: <span id="score-b">0</span></div>
      </div>

      <div class="controls">
        <button id="reveal-btn" disabled>גלה תשובה</button>
        <button id="next-btn" disabled>שאלה הבאה</button>
        <button id="finish-btn">סיים את החידון</button>
      </div>

      <div class="footer">
        שאלה <span id="current-question">1</span>/<span id="total-questions"
          >0</span
        >
      </div>
    </div>

    <!-- Final Screen -->
    <div class="final-screen" id="final-screen">
      <h2 id="final-message">מנצחת!</h2>
      <p id="final-scores">קבוצה א׳: 0 נקודות | קבוצה ב׳: 0 נקודות</p>
      <button id="restart-btn">התחל מחדש</button>
    </div>

    <script>
      const quizData = [
        {
          mainAnimal: {
            name: "לווייתן",
            image: "images/whale.jpg",
          },
          options: [
            { name: "כלב ים", image: "images/seal.jpg" },
            { name: "ביזון", image: "images/bison.jpg", correct: true },
            { name: "תחש נהרות", image: "images/manatee.jpg" },
          ],
          explanation:
            "הלווייתן קרוב יותר מבחינה אבולוציונית לביזון מאשר לכלב ים או תחש נהרות.",
        },
        {
          mainAnimal: {
            name: "שפן סלע",
            image: "images/rockhyrax.jpg",
          },
          options: [
            { name: "פיל", image: "images/elephant.jpg", correct: true },
            { name: "קפיברה", image: "images/capybara.jpg" },
            { name: "ארנבת בר", image: "images/hare.jpg" },
          ],
          explanation:
            "שפן סלע קרוב יותר מבחינה אבולוציונית לפיל מאשר לקפיברה או ארנבת בר.",
        },
        {
          mainAnimal: {
            name: "דינוזאור",
            image: "images/dinosaur.jpg",
          },
          options: [
            { name: "יונה", image: "images/pigeon.jpg", correct: true },
            { name: "לטאת כוח", image: "images/monitorlizard.jpg" },
            { name: "תנין", image: "images/crocodile.jpg" },
          ],
          explanation:
            "יונה קרובה יותר לדינוזאור מאשר לטאת כוח או תנין, הודות לקרבה אבולוציונית.",
        },
        {
          mainAnimal: {
            name: "קרנף",
            image: "images/rhino.jpg",
          },
          options: [
            { name: "פיל", image: "images/elephant.jpg" },
            { name: "היפופוטם", image: "images/hippo.jpg" },
            { name: "סוס", image: "images/horse.jpg", correct: true },
          ],
          explanation:
            "סוס קרוב יותר לקרנף מאשר לפיל או להיפופוטם מבחינה אבולוציונית.",
        },
        {
          mainAnimal: {
            name: "סלמנדרה",
            image: "images/salamander.jpg",
          },
          options: [
            { name: "קרפדה", image: "images/toad.jpg", correct: true },
            { name: "זיקית", image: "images/chameleon.jpg" },
            { name: "שממית", image: "images/gecko.jpg" },
          ],
          explanation:
            "ג'ירפה קרובה יותר לאוקפי מאשר לשימפנזה או טפיר אסייתי, מכיוון ששניהם שייכים לאותה משפחה.",
        },
        {
          mainAnimal: {
            name: "אוקפי",
            image: "images/okapi.jpg",
          },
          options: [
            { name: "זברה", image: "images/zebra.jpg" },
            { name: "ג'ירפה", image: "images/giraffe.jpg", correct: true },
            { name: "טפיר אסייתי", image: "images/tapir.jpg" },
          ],
          explanation:
            "ג'ירפה קרובה יותר לאוקפי מאשר לשימפנזה או טפיר אסייתי, מכיוון ששניהם שייכים לאותה משפחה.",
        },
        {
          mainAnimal: {
            name: "צבוע",
            image: "images/hyena.jpg",
          },
          options: [
            { name: "תן", image: "images/jackal.jpg" },
            {
              name: "נמייה ננסית",
              image: "images/mongoose.jpg",
              correct: true,
            },
            { name: "גירית דבש", image: "images/honeybadger.jpg" },
          ],
          explanation: "נמייה נסית קרובה יותר לצב מאשר לגירית דבש או תן.",
        },
        {
          mainAnimal: {
            name: "חדף פיל",
            image: "images/shrew.jpg",
          },
          options: [
            { name: "פיל", image: "images/elephant.jpg", correct: true },
            { name: "אוגר", image: "images/hamster.jpg" },
            { name: "עכבר", image: "images/mouse.jpg" },
          ],
          explanation: "חדר פיל נקשר לפיל בצורה ישירה יותר מאשר לעכבר או אוגר.",
        },
      ];

      let currentQuestion = 0;
      let scores = { a: 0, b: 0 };
      let selections = { a: null, b: null };

      const updateUI = () => {
        const question = quizData[currentQuestion];

        document.getElementById("main-animal-name").textContent =
          question.mainAnimal.name;
        document.getElementById("main-animal-img").src =
          question.mainAnimal.image;

        const optionsContainer = document.getElementById("options-container");
        optionsContainer.innerHTML = "";

        question.options.forEach((option, index) => {
          const optionElement = document.createElement("div");
          optionElement.className = "option";
          optionElement.innerHTML = `
              <div class="team-label">קבוצה</div>
              <img src="${option.image}" alt="${option.name}">
              <h3>${option.name}</h3>
            `;
          // Attach our modified select function
          optionElement.addEventListener("click", () => selectOption(index));
          optionsContainer.appendChild(optionElement);
        });

        document.getElementById("current-question").textContent =
          currentQuestion + 1;
        document.getElementById("total-questions").textContent =
          quizData.length;

        document.getElementById("reveal-btn").disabled = true;
        document.getElementById("next-btn").disabled = true;

        // Reset selections for this round
        selections = { a: null, b: null };

        // Hide explanation section
        document.getElementById("explanation-container").style.display = "none";
        document.getElementById("explanation-text").textContent = "";
      };

      /**
       * Modified selectOption() that allows:
       * 1) Toggling (deselecting) a choice for each team.
       * 2) Both teams can choose the same option.
       */
      const selectOption = (index) => {
        const options = document.querySelectorAll(".option");
        const option = options[index];
        const teamLabel = option.querySelector(".team-label");

        // CASE 1: If Team A hasn't picked yet, select for A
        if (selections.a === null) {
          selections.a = index;
          option.classList.add("selected-a");
          teamLabel.textContent = "קבוצה א׳";
          teamLabel.style.opacity = "1";
        }

        // CASE 2: If Team A already picked but Team B hasn't, pick for B
        else if (selections.b === null) {
          selections.b = index;
          option.classList.add("selected-b");
          teamLabel.textContent = "קבוצה ב׳";
          teamLabel.style.opacity = "1";
        }

        // CASE 3: Both teams have selections, so handle toggling/deselecting
        else {
          // If both teams picked the same option, clicking it again removes it from both
          if (selections.a === index && selections.b === index) {
            selections.a = null;
            selections.b = null;
            option.classList.remove("selected-a", "selected-b", "shared");
            teamLabel.style.opacity = "0";
          }
          // If only Team A picked this option, toggle off A
          else if (selections.a === index) {
            selections.a = null;
            option.classList.remove("selected-a");
            // If B did not also pick it, hide label
            if (selections.b !== index) {
              teamLabel.style.opacity = "0";
            }
          }
          // If only Team B picked this option, toggle off B
          else if (selections.b === index) {
            selections.b = null;
            option.classList.remove("selected-b");
            // If A did not also pick it, hide label
            if (selections.a !== index) {
              teamLabel.style.opacity = "0";
            }
          }
          // If we got here, it means user clicked a completely different option
          // while both teams had selections. For simplicity, do nothing or
          // replace one team's choice. (This is up to you!)
        }

        // Handle the .shared class if both ended up on the same selection
        // after the above logic
        if (selections.a === index && selections.b === index) {
          option.classList.add("shared");
          teamLabel.textContent = "2 הקבוצות";
        } else {
          option.classList.remove("shared");
        }

        // Enable "Reveal" button only if both teams have made a selection
        document.getElementById("reveal-btn").disabled =
          selections.a === null || selections.b === null;
      };
      const revealAnswer = () => {
        const question = quizData[currentQuestion];
        const options = document.querySelectorAll(".option");
        const correctIndex = question.options.findIndex(
          (option) => option.correct
        );

        options.forEach((option, index) => {
          if (index === correctIndex) {
            option.classList.add("correct");
          } else if (selections.a === index || selections.b === index) {
            option.classList.add("incorrect");
          }
        });

        if (selections.a === correctIndex) scores.a++;
        if (selections.b === correctIndex) scores.b++;

        document.getElementById("score-a").textContent = scores.a;
        document.getElementById("score-b").textContent = scores.b;

        // Display explanation
        const explanationText = question.explanation || "";
        const explanationContainer = document.getElementById(
          "explanation-container"
        );
        const explanationParagraph =
          document.getElementById("explanation-text");
        explanationParagraph.textContent = explanationText;
        explanationContainer.style.display = "block";

        document.getElementById("reveal-btn").disabled = true;
        document.getElementById("next-btn").disabled = false;
      };

      const nextQuestion = () => {
        currentQuestion++;
        if (currentQuestion >= quizData.length) {
          showFinalScreen();
        } else {
          updateUI();
        }
      };

      const showFinalScreen = () => {
        const finalScreen = document.getElementById("final-screen");
        const finalMessage = document.getElementById("final-message");
        const finalScores = document.getElementById("final-scores");

        // Determine the winner
        let message = "";
        if (scores.a > scores.b) {
          message = "קבוצה א׳ ניצחה!";
        } else if (scores.b > scores.a) {
          message = "קבוצה ב׳ ניצחה!";
        } else {
          message = "תיקו!";
        }

        finalMessage.textContent = message;
        finalScores.textContent = `קבוצה א׳: ${scores.a} נקודות | קבוצה ב׳: ${scores.b} נקודות`;

        finalScreen.style.display = "flex";

        // Trigger confetti for 30 seconds
        const duration = 30 * 1000;
        const confettiInterval = 500;
        const end = Date.now() + duration;

        const confettiLoop = setInterval(() => {
          confetti({
            particleCount: 50,
            angle: 60,
            spread: 100,
            origin: { x: 0 },
            zIndex: 1000,
          });

          confetti({
            particleCount: 50,
            angle: 120,
            spread: 100,
            origin: { x: 1 },
            zIndex: 1000,
          });

          if (Date.now() > end) {
            clearInterval(confettiLoop);
            confetti.reset();
          }
        }, confettiInterval);
      };

      const restartQuiz = () => {
        // Reset scores and question index
        currentQuestion = 0;
        scores = { a: 0, b: 0 };
        selections = { a: null, b: null };

        // Update scores in UI
        document.getElementById("score-a").textContent = scores.a;
        document.getElementById("score-b").textContent = scores.b;

        // Hide final screen
        document.getElementById("final-screen").style.display = "none";

        // Update UI for the first question
        updateUI();
      };

      const finishQuiz = () => {
        showFinalScreen();
      };

      document
        .getElementById("reveal-btn")
        .addEventListener("click", revealAnswer);
      document
        .getElementById("next-btn")
        .addEventListener("click", nextQuestion);
      document
        .getElementById("restart-btn")
        .addEventListener("click", restartQuiz);

      document
        .getElementById("finish-btn")
        .addEventListener("click", finishQuiz);

      updateUI();
    </script>
  </body>
</html>
